OpenAI Codex v0.104.0 (research preview)
--------
workdir: /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker
model: gpt-5.3-codex
provider: openai
approval: never
sandbox: read-only
reasoning effort: xhigh
reasoning summaries: auto
session id: 019c80a7-b9c8-7071-9dcc-ce65c3fbed4c
--------
user
Read the file at /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker/agents/counselors/1771684952-zsync-ios-design/prompt.md and follow the instructions within it.
mcp: chrome-devtools starting
mcp: context7 starting
mcp: context7 ready
mcp: chrome-devtools ready
mcp startup: ready: context7, chrome-devtools

thinking
**Acknowledging file reading request**
codex
Iâ€™ll open that `prompt.md` file first, then execute exactly what it asks within the repo constraints.
exec
/bin/zsh -lc "cat '/Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker/agents/counselors/1771684952-zsync-ios-design/prompt.md'" in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker succeeded in 54ms:
# Design Review Request: Zsync â€” Native iOS SSH/Mosh Session Manager

## Question

We are designing a native iOS app called **Zsync** â€” a zmosh session picker and SSH terminal client. Think "cmux for iOS" â€” a native app that discovers, manages, and connects to zmosh sessions across multiple machines, synced via iCloud.

Please review this design for:
- Architectural soundness
- Risks and blind spots
- UX considerations for a mobile terminal app
- Technical feasibility
- Missing features or overlooked concerns
- Whether the tech stack choices are optimal

## Context

### What is zmosh-picker (the existing project)?

Read @zmosh-picker to understand the current zsh-based session picker. It's a pure-zsh, single-keypress TUI that shows zmosh sessions on login and lets you attach with one keypress. Mobile-first design â€” optimized for SSH from phones.


thinking
**Planning file inspection**
codex
Iâ€™ve loaded the prompt. Next Iâ€™m reading the referenced project docs (`README`, design plan, and prototype) so the review is grounded in the actual system.
exec
/bin/zsh -lc 'ls -la' in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker succeeded in 52ms:
total 80
drwxr-xr-x@ 13 nerveband  staff   416 Feb 21 09:42 .
drwxr-xr-x@ 97 nerveband  staff  3104 Feb 20 22:44 ..
drwxr-xr-x@ 12 nerveband  staff   384 Feb 21 07:13 .git
-rw-r--r--@  1 nerveband  staff   715 Feb 21 06:16 CHANGELOG.md
-rw-r--r--@  1 nerveband  staff  1067 Feb 20 22:53 LICENSE
-rw-r--r--@  1 nerveband  staff  5343 Feb 21 06:22 README.md
drwxr-xr-x@  3 nerveband  staff    96 Feb 21 09:42 agents
drwxr-xr-x@  3 nerveband  staff    96 Feb 21 06:23 assets
drwxr-xr-x@  3 nerveband  staff    96 Feb 20 22:44 docs
-rwxr-xr-x@  1 nerveband  staff  4108 Feb 20 23:44 install.sh
drwxr-xr-x@  3 nerveband  staff    96 Feb 21 09:37 prototype
-rwxr-xr-x@  1 nerveband  staff   502 Feb 20 23:44 uninstall.sh
-rwxr-xr-x@  1 nerveband  staff  8223 Feb 21 06:16 zmosh-picker
exec
/bin/zsh -lc 'cat README.md' in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-pickerexec
/bin/zsh -lc 'cat docs/plans/2026-02-20-zmosh-picker-design.md' in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-pickerexec
/bin/zsh -lc 'cat prototype/zsync.html' in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker succeeded in 51ms:
# zmosh-picker

Session launcher for [zmosh](https://github.com/mmonad/zmosh). One keypress to resume any session.

<p align="center">
  <img src="assets/screenshot.svg" alt="zmosh-picker in action" width="680">
</p>

## Why

The idea is simple: if every terminal on your Mac starts inside a zmosh session, then every session is always there waiting for you when you pick up your phone.

I SSH from my phone a lot. The annoying part was never the SSH itself â€” it was arriving on the remote machine and not knowing what sessions exist, or having to type `zmosh attach some-long-name` on a phone keyboard. Half the time I'd just start fresh and lose whatever I was working on.

So I made this run on every terminal. Now my Mac is constantly creating and resuming named sessions without me thinking about it. When I SSH from my phone later, those sessions are right there. Press `1`. Done.

It also handles new sessions â€” `Enter` creates one named after your current directory, `z` lets you pick a project via zoxide first. But the real point is: your Mac does the work of keeping sessions alive, and your phone just picks them up.

## Dependencies

 succeeded in 51ms:
# zmosh-picker Design

## Problem

Persistent sessions should be the default, not something you opt into. When you open a terminal â€” whether on your Mac, SSH'd from an iPad, or mosh'd from your phone â€” you should immediately see your active sessions and resume one with a single keypress. Creating a new session in any project directory should be just as fast.

Without this, you end up with orphaned shells, lost context, and the friction of manually running `zmosh attach <name>` every time. That friction compounds across devices.

## Design Decisions

### Single-keypress UX

Every action in the picker is one keypress. No typing session names, no arrow-key navigation, no confirmation prompts. This matters most on mobile (Blink Shell, Termius) where typing is painful and every saved keystroke counts.

### Directory-aware naming via zoxide

SSH always starts in `~`, making `$PWD`-based names useless for remote sessions. Integrating zoxide's interactive picker (`zi`) lets you jump to any frequently-used project directory before creating a session, and the session inherits that directory's name. On a Mac, this is equally useful â€” you're often in `~` when a new terminal opens.

### No window management

 succeeded in 51ms:
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Zsync</title>
<style>
  :root {
    --bg: #000000;
    --bg-card: #1c1c1e;
    --bg-card-hover: #2c2c2e;
    --bg-input: #2c2c2e;
    --bg-keybar: #1a1a1c;
    --text: #ffffff;
    --text-secondary: #8e8e93;
    --text-tertiary: #636366;
    --accent: #0a84ff;
    --green: #30d158;

thinking
**Reading main session picker script**
codex
Iâ€™ve reviewed the high-level docs and prototype. Iâ€™m now reading the `zmosh-picker` script itself to validate behavior details before writing the critique.
exec
/bin/zsh -lc 'cat zmosh-picker' in /Users/nerveband/wavedepth Dropbox/Ashraf Ali/Mac (2)/Documents/GitHub/zmosh-picker succeeded in 52ms:
#!/usr/bin/env zsh
# zmosh-picker â€” single-keypress session launcher for zmosh
# https://github.com/nerveband/zmosh-picker

_zmosh_picker_main() {
  # â”€â”€â”€ Guards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  [[ ! -o interactive ]] && return 0
  [[ -n "$ZMX_SESSION" && -z "$ZPICK" ]] && return 0
  [[ ! -t 0 ]] && return 0
  command -v zmosh &>/dev/null || return 0
  unset ZPICK

  # â”€â”€â”€ Colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  local R=$'\e[0m' D=$'\e[2m'
  local rd=$'\e[31m' cy=$'\e[36m' gn=$'\e[32m' yl=$'\e[33m' mg=$'\e[35m'
  local Brd=$'\e[1;31m' Bcy=$'\e[1;36m' Bgn=$'\e[1;32m' Byl=$'\e[1;33m' Bwh=$'\e[1;97m'

  # â”€â”€â”€ Name generators â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


thinking
**Planning exhaustive web verification**
ğŸŒ Searching the web...
ğŸŒ Searched: SwiftTerm GitHub repository iOS terminal view maintenance

thinking
**Refining search query for Citadel**
ğŸŒ Searching the web...
ğŸŒ Searched: Citadel Swift SSH client library GitHub iOS

thinking
**Exploring source details and dependencies**
ğŸŒ Searching the web...
ğŸŒ Searched: https://github.com/migueldeicaza/SwiftTerm

thinking
**Identifying missing content patterns**
ğŸŒ Searching the web...
ğŸŒ Searched: 'Last commit date' in https://github.com/orlandos-nl/Citadel

thinking
**Checking SwiftTerm release activity**
ğŸŒ Searching the web...
ğŸŒ Searched: 'Releases' in https://github.com/migueldeicaza/SwiftTerm

thinking
**Searching release details**
ğŸŒ Searching the web...
ğŸŒ Searched: 'Releases' in https://github.com/apple/swift-nio-ssh

thinking
**Planning Apple docs search**
ğŸŒ Searching the web...
ğŸŒ Searched: Apple SwiftData CloudKit sync limitations conflict resolution

thinking
**Gathering updated Apple background docs**
ğŸŒ Searching the web...
ğŸŒ Searched: iOS app background network sockets suspended existing connections may close documentation

thinking
**Refining search scope**
ğŸŒ Searching the web...
ğŸŒ Searched: developer.apple.com UIApplication beginBackgroundTask expiration handler

thinking
**Correcting query domain placement**
ğŸŒ Searching the web...
ğŸŒ Searched: UIApplication beginBackgroundTask expiration handler

thinking
**Identifying iCloud sync deletion risk**
ğŸŒ Searching the web...
ğŸŒ Searched: SFSpeechRecognizer requires network connection if on-device unavailable

thinking
**Focusing on primary licensing sources**
ğŸŒ Searching the web...
ğŸŒ Searched: GNU GPL v3 conveying object code Corresponding Source requirements gnu.org

thinking
**Searching license in repo**
ğŸŒ Searching the web...
ğŸŒ Searched: mosh mobile shell GitHub license

thinking
**Planning licensing and feature review**
ğŸŒ Searching the web...
ğŸŒ Searched: https://raw.githubusercontent.com/orlandos-nl/Citadel/main/README.md

thinking
**Adjusting raw file access approach**
ğŸŒ Searching the web...
ğŸŒ Searched: https://raw.githubusercontent.com/apple/swift-nio-ssh/main/README.md

thinking
**Verifying README raw URL**
ğŸŒ Searching the web...
ğŸŒ Searched: https://raw.githubusercontent.com/blinksh/blink/main/README.md

thinking
**Assessing library licensing and language model support**
ğŸŒ Searching the web...
ğŸŒ Searched: SFCustomLanguageModelData supported locales iOS 17 speech framework

thinking
**Reviewing export compliance considerations**
ğŸŒ Searching the web...
ğŸŒ Searched: App Store Connect export compliance encryption SSH app

thinking
**Evaluating architecture, UX, sync, licensing, monetization**
ğŸŒ Searching the web...
ğŸŒ Searched: Blink Shell App Store pricing 2026

thinking
**Searching competitor apps**
ğŸŒ Searching the web...
ğŸŒ Searched: Blink Shell iOS App Store price

thinking
**Verifying licensing for alternatives**
ğŸŒ Searching the web...
ğŸŒ Searched: Eternal Terminal license GitHub

thinking
**Planning data source gathering**
ğŸŒ Searching the web...
ğŸŒ Searched: kSecAttrSynchronizable keychain iCloud keychain items sync

thinking
**Confirming secure enclave key sync**
ğŸŒ Searching the web...
ğŸŒ Searched: kSecAttrAccessibleWhenUnlockedThisDeviceOnly not migrated or synced

thinking
**Assessing keychain and sync limits**
ğŸŒ Searching the web...
ğŸŒ Searched: https://developer.apple.com/forums/thread/805940
ğŸŒ Searching the web...
ğŸŒ Searched: https://developer.apple.com/forums/thread/779302

thinking
**Listing appraisal points and references**
codex
Iâ€™ve finished the source review and Iâ€™m drafting the final design critique now, including concrete risks, what to cut/add for v1, licensing impact, and a monetization recommendation.

thinking
**Structuring thorough feedback with clear moderate detail**
codex
**Overall Verdict**
Pure-native Swift is the right call. The design is strong, but there is one major blocker: `mosh` on iOS without GPL contamination. Everything else is solvable with good scoping.

**1) Architecture**
- Yes: `SwiftUI + SwiftTerm + SwiftData/CloudKit + Keychain` is a sensible v1 stack.
- Keep `Citadel` behind your own transport protocol so you can swap to raw `swift-nio-ssh` if needed.
- Biggest stack caveat: `swift-nio-ssh` is a low-level toolkit, not a full SSH client; you must own PTY, half-close behavior, channel lifecycle, host key UX, etc.
- `SwiftTerm` is mature and active, but it still calls out selection/accessibility caveats. Plan explicit accessibility work.

**2) UX**
- Three-screen flow is correct for iPhone.
- Quick-jump recents are good, but add stale-state handling: session missing, machine offline, renamed session.
- Composition + key bar is directionally right, but the Passthrough/Compose mode toggle can cause mode errors. Prefer a mode-light design:
  - Default passthrough.
  - â€œCompose onceâ€ action instead of global mode switch.
- Swipe-to-kill is risky for destructive remote actions. Require confirm or undo window.

**3) Biggest Technical Risks (ranked)**
1. iOS background behavior. You cannot rely on persistent UDP/TCP when suspended; treat resume as reconnect-first, not continuous.
2. Host key trust + SSH security UX. A weak TOFU flow will burn trust fast.
3. Terminal fidelity under mobile input. External keyboard, modifier-state, IME/dictation, and paste behavior are where bugs surface.
4. Session discovery latency. SSH-ing into multiple machines serially will feel slow; use parallel fetch + cache + timeout.
5. Cloud sync edge cases. SwiftData+CloudKit has real pitfalls around schema/default values and iCloud-toggle behavior.

**4) Missing V1 Features**
- Known-hosts management (fingerprint review, pinning, rotation handling).
- Onboarding health check per machine (`zmosh` installed, UDP reachable, auth valid).
- Session search/filter (not just list).
- Export/import backup for machine configs.
- External keyboard optimized mode (hide key bar, richer shortcuts).
- Biometric app lock and per-key usage policy.
- Failure visibility: reconnect reason, auth failures, machine health badges.

**5) Licensing (critical)**
- If you link GPL-3.0 `libmoshios`/Blink code, you likely pull your app into GPL obligations. That conflicts with your desired proprietary/commercial path.
- Recommendation: do **not** ship GPL mosh client code in v1.
- Safer options:
  - Ship SSH-first v1.
  - Add clean-room mosh-compatible implementation later.
  - Consider Eternal Terminal support (Apache-2.0) as resilient-session alternative.
- Not legal advice, but this needs real counsel before implementation.

**6) Voice Input**
- Keyboard dictation alone is enough for v1.
- Custom `SFSpeechRecognizer` language model is useful later, but only after core terminal reliability is done.
- If you add custom voice:
  - Compose-only.
  - Never auto-send to shell.
  - Mandatory preview/confirm.
- Speech APIs also have operational limits/permissions overhead that add support burden.

**7) Sync**
- SwiftData + CloudKit is fine for machine metadata.
- Donâ€™t assume key material sync â€œjust works.â€ Decide explicitly what syncs.
- Keep private keys local by default; only sync if intentionally marked synchronizable and policy-approved.
- Strong recommendation: separate local source-of-truth from cloud mirror semantics to avoid destructive surprises when iCloud state changes.

**8) Monetization**
As of **February 21, 2026**, market anchor points are high (`Termius` Pro ~$15/mo or $119/yr; `Prompt 3` ~$19.99/yr or $99.99 one-time).  
Best path for your niche:
- Free tier: 1 machine, SSH only.
- One-time Pro unlock: unlimited machines, advanced keyboard/theming, recents/power UX.
- Optional annual add-on: premium sync/collab/AI voice extras.
- Avoid subscription-only at launch; terminal users strongly value ownership.

**Recommended scope adjustment**
- V1: SSH + zmosh picker workflow + polished keyboard + secure key/host trust + fast discovery.
- V1.5: Cloud polish + external keyboard depth.
- V2: mosh-compatible transport only after licensing-safe path is settled.

**Sources**
- Local project context: `README.md`, `docs/plans/2026-02-20-zmosh-picker-design.md`, `zmosh-picker`, `prototype/zsync.html`
- SwiftTerm: https://github.com/migueldeicaza/SwiftTerm
- Citadel: https://github.com/orlandos-nl/Citadel
- SwiftNIO SSH: https://github.com/apple/swift-nio-ssh
- Blink repo/license context: https://github.com/blinksh/blink
- Mosh license: https://github.com/mobile-shell/mosh
- GNU GPL FAQ: https://www.gnu.org/licenses/gpl-faq.html
- Apple background behavior docs: https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/WorkLessInTheBackground.html
- Speech framework docs/sample: https://developer.apple.com/documentation/speech/recognizing-speech-in-live-audio
- Speech API limits QA1951: https://developer.apple.com/library/archive/qa/qa1951/_index.html
- CloudKit limits/errors: https://developer.apple.com/library/archive/documentation/DataManagement/Conceptual/CloudKitWebServicesReference/PropertyMetrics.html
- SwiftData/CloudKit DTS forum notes: https://developer.apple.com/forums/thread/779302 and https://developer.apple.com/forums/thread/805940
- App Store export compliance: https://developer.apple.com/help/app-store-connect/manage-app-information/overview-of-export-compliance
- Competitor pricing/features: https://apps.apple.com/us/app/termius/id549039908 and https://apps.apple.com/us/app/prompt-3/id1594420480
tokens used
136,617
